// Generated by LiveScript 1.2.0
(function(){
  var Class, _, lo, requires, Decorations, Repo, CtxDecorations;
  Class = require('jsclass/src/core').Class;
  _ = require('prelude-ls');
  lo = require('lodash');
  require('sugar');
  requires = require('../requires');
  Decorations = requires.lib('decorations');
  Repo = requires.lib('repo');
  CtxDecorations = new Class(Repo, {
    initialize: function(decorations){
      return this.callSuper();
    },
    getRepo: function(ctxName){
      var decs;
      ctxName || (ctxName = 'default');
      decs = this.repository.find(ctxName) || new Decorations;
      console.log(ctxName, decs);
      this.repository.store(ctxName, decs);
      return decs;
    },
    find: function(ctxName, model){
      if (model === void 8) {
        model = ctxName;
        ctxName = 'default';
      }
      console.log(ctxName, model);
      return this.getRepo(ctxName).find(model);
    },
    register: function(){
      var decoration, name, ctx, obj;
      switch (arguments.length) {
      case 1:
        decoration = arguments.first;
        name = this.nameOf(decoration);
        this.getRepo().register(name, decoration);
        break;
      case 2:
        decoration = arguments.last;
        ctx = arguments.first;
        name = this.nameOf(decoration);
        this.getRepo(ctx).register(name, decoration);
      }
      obj = name != null
        ? decorations
        : decorations[name];
      this.repository.register(ctx, obj);
      return {
        nameOf: function(decoration){
          if (!_.typeOf('Object', decoration)) {
            throw Error("Decorator must be an Object, was: " + decoration);
          }
          return decoration.name();
        }
      };
    },
    registerList: function(){
      var self, decorations, ctx;
      self = this;
      switch (arguments.length) {
      case 1:
        decorations = arguments.first;
        return decorations.each(function(dec){
          return self.register(dec);
        });
      case 2:
        ctx = arguments.first;
        decorations = arguments.last;
        switch (typeof decorations) {
        case 'array':
          return decorations.each(function(dec){
            return self.register(ctx, dec);
          });
        case 'object':
          return decorations.each(function(name, dec){
            return self.register(ctx, name, dec);
          });
        }
      }
    }
  });
  module.exports = CtxDecorations;
}).call(this);
